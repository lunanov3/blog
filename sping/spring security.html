<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring security 配置 | luna-blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="一枚"即将"成型的程序猿.大三生">
    
    <link rel="preload" href="/blog/assets/css/0.styles.9f487158.css" as="style"><link rel="preload" href="/blog/assets/js/app.5f78a6e3.js" as="script"><link rel="preload" href="/blog/assets/js/3.068b4ef9.js" as="script"><link rel="preload" href="/blog/assets/js/1.3a4037f8.js" as="script"><link rel="preload" href="/blog/assets/js/78.5acf7838.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.4522b131.js"><link rel="prefetch" href="/blog/assets/js/11.42ec9fdf.js"><link rel="prefetch" href="/blog/assets/js/12.85f3f17e.js"><link rel="prefetch" href="/blog/assets/js/13.3c3d8e9d.js"><link rel="prefetch" href="/blog/assets/js/14.27e73396.js"><link rel="prefetch" href="/blog/assets/js/15.2e5810a9.js"><link rel="prefetch" href="/blog/assets/js/16.34c7f4d3.js"><link rel="prefetch" href="/blog/assets/js/17.c55fe65a.js"><link rel="prefetch" href="/blog/assets/js/18.ca429628.js"><link rel="prefetch" href="/blog/assets/js/19.fc1374ea.js"><link rel="prefetch" href="/blog/assets/js/20.6ff780e2.js"><link rel="prefetch" href="/blog/assets/js/21.8284dd8d.js"><link rel="prefetch" href="/blog/assets/js/22.7dd33d8a.js"><link rel="prefetch" href="/blog/assets/js/23.ca60c966.js"><link rel="prefetch" href="/blog/assets/js/24.aadc1eb1.js"><link rel="prefetch" href="/blog/assets/js/25.43f88e52.js"><link rel="prefetch" href="/blog/assets/js/26.57d9e028.js"><link rel="prefetch" href="/blog/assets/js/27.53dff949.js"><link rel="prefetch" href="/blog/assets/js/28.04c3e0db.js"><link rel="prefetch" href="/blog/assets/js/29.d9b12b5e.js"><link rel="prefetch" href="/blog/assets/js/30.a6123954.js"><link rel="prefetch" href="/blog/assets/js/31.77559b13.js"><link rel="prefetch" href="/blog/assets/js/32.2c6e1cfe.js"><link rel="prefetch" href="/blog/assets/js/33.50e9dc1e.js"><link rel="prefetch" href="/blog/assets/js/34.65cb529f.js"><link rel="prefetch" href="/blog/assets/js/35.c394b802.js"><link rel="prefetch" href="/blog/assets/js/36.f138ee36.js"><link rel="prefetch" href="/blog/assets/js/37.150225f6.js"><link rel="prefetch" href="/blog/assets/js/38.95e50f7f.js"><link rel="prefetch" href="/blog/assets/js/39.a9339cb9.js"><link rel="prefetch" href="/blog/assets/js/4.44e0606f.js"><link rel="prefetch" href="/blog/assets/js/40.71be6191.js"><link rel="prefetch" href="/blog/assets/js/41.a70e6950.js"><link rel="prefetch" href="/blog/assets/js/42.96afe6e7.js"><link rel="prefetch" href="/blog/assets/js/43.f57eb320.js"><link rel="prefetch" href="/blog/assets/js/44.3a4e0e3d.js"><link rel="prefetch" href="/blog/assets/js/45.a282eb30.js"><link rel="prefetch" href="/blog/assets/js/46.ef3de8ee.js"><link rel="prefetch" href="/blog/assets/js/47.50ffd8ad.js"><link rel="prefetch" href="/blog/assets/js/48.762b2aad.js"><link rel="prefetch" href="/blog/assets/js/49.d99b05d7.js"><link rel="prefetch" href="/blog/assets/js/5.9e25b12a.js"><link rel="prefetch" href="/blog/assets/js/50.cbfc6439.js"><link rel="prefetch" href="/blog/assets/js/51.1c9707eb.js"><link rel="prefetch" href="/blog/assets/js/52.eca44a55.js"><link rel="prefetch" href="/blog/assets/js/53.7e8c7dd5.js"><link rel="prefetch" href="/blog/assets/js/54.c20ce29b.js"><link rel="prefetch" href="/blog/assets/js/55.deb4d681.js"><link rel="prefetch" href="/blog/assets/js/56.2b85243e.js"><link rel="prefetch" href="/blog/assets/js/57.774ded89.js"><link rel="prefetch" href="/blog/assets/js/58.d4cd111a.js"><link rel="prefetch" href="/blog/assets/js/59.01cc1fa7.js"><link rel="prefetch" href="/blog/assets/js/6.b0732af1.js"><link rel="prefetch" href="/blog/assets/js/60.1fed4e99.js"><link rel="prefetch" href="/blog/assets/js/61.8b9cb327.js"><link rel="prefetch" href="/blog/assets/js/62.8baa50e8.js"><link rel="prefetch" href="/blog/assets/js/63.4b4452b7.js"><link rel="prefetch" href="/blog/assets/js/64.0be6aef9.js"><link rel="prefetch" href="/blog/assets/js/65.6a164ba0.js"><link rel="prefetch" href="/blog/assets/js/66.7369f4c9.js"><link rel="prefetch" href="/blog/assets/js/67.713cabc4.js"><link rel="prefetch" href="/blog/assets/js/68.cce7f83a.js"><link rel="prefetch" href="/blog/assets/js/69.a26ba16f.js"><link rel="prefetch" href="/blog/assets/js/7.3ec5443a.js"><link rel="prefetch" href="/blog/assets/js/70.1c85e197.js"><link rel="prefetch" href="/blog/assets/js/71.0889f9df.js"><link rel="prefetch" href="/blog/assets/js/72.befe54c5.js"><link rel="prefetch" href="/blog/assets/js/73.c8cf1686.js"><link rel="prefetch" href="/blog/assets/js/74.b308db34.js"><link rel="prefetch" href="/blog/assets/js/75.f815a586.js"><link rel="prefetch" href="/blog/assets/js/76.66d0cc60.js"><link rel="prefetch" href="/blog/assets/js/77.2ecae0de.js"><link rel="prefetch" href="/blog/assets/js/79.7bc72950.js"><link rel="prefetch" href="/blog/assets/js/8.1bc5ae83.js"><link rel="prefetch" href="/blog/assets/js/80.d8398906.js"><link rel="prefetch" href="/blog/assets/js/81.0f826cde.js"><link rel="prefetch" href="/blog/assets/js/9.775ea94d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.9f487158.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>luna-blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>luna</span>
            
          <span data-v-64685f0e>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/images/xiaoxin.jpg" alt="luna-blog" class="logo"> <span class="site-name">luna-blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/日志/" class="nav-link"><i class="iconfont undefined"></i>
  日志
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/个人/" class="nav-link"><i class="iconfont undefined"></i>
  个人
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/通讯/" class="nav-link"><i class="iconfont undefined"></i>
  通讯
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/docker/" class="nav-link"><i class="iconfont undefined"></i>
  docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/luna/" class="nav-link"><i class="iconfont undefined"></i>
  luna
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/genesis/" class="nav-link"><i class="iconfont undefined"></i>
  genesis
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/kaili/" class="nav-link"><i class="iconfont undefined"></i>
  kaili
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/mybatis/" class="nav-link"><i class="iconfont undefined"></i>
  mybatis
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/mysql/" class="nav-link"><i class="iconfont undefined"></i>
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/spring/" class="nav-link"><i class="iconfont undefined"></i>
  spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  关键字
</a></div><div class="nav-item"><a href="/blog/forme.html" class="nav-link"><i class="iconfont undefined"></i>
  readme
</a></div><div class="nav-item"><a href="/blog/categories/日志/" class="nav-link"><i class="iconfont undefined"></i>
  日志
</a></div><div class="nav-item"><a href="/blog/categories/个人/" class="nav-link"><i class="iconfont undefined"></i>
  个人
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://gitee.com/luna_nov/blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  本站源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://iszychen.club" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  luna
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><!----> <h3 class="name" data-v-ca798c94>
    luna
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>70</h3> <h6 data-v-ca798c94>文章</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>42</h3> <h6 data-v-ca798c94>标签</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/日志/" class="nav-link"><i class="iconfont undefined"></i>
  日志
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/个人/" class="nav-link"><i class="iconfont undefined"></i>
  个人
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/通讯/" class="nav-link"><i class="iconfont undefined"></i>
  通讯
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/docker/" class="nav-link"><i class="iconfont undefined"></i>
  docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/luna/" class="nav-link"><i class="iconfont undefined"></i>
  luna
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/genesis/" class="nav-link"><i class="iconfont undefined"></i>
  genesis
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/kaili/" class="nav-link"><i class="iconfont undefined"></i>
  kaili
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/mybatis/" class="nav-link"><i class="iconfont undefined"></i>
  mybatis
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/mysql/" class="nav-link"><i class="iconfont undefined"></i>
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/spring/" class="nav-link"><i class="iconfont undefined"></i>
  spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  关键字
</a></div><div class="nav-item"><a href="/blog/forme.html" class="nav-link"><i class="iconfont undefined"></i>
  readme
</a></div><div class="nav-item"><a href="/blog/categories/日志/" class="nav-link"><i class="iconfont undefined"></i>
  日志
</a></div><div class="nav-item"><a href="/blog/categories/个人/" class="nav-link"><i class="iconfont undefined"></i>
  个人
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="https://gitee.com/luna_nov/blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  本站源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://iszychen.club" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  luna
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>sping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/sping/anno.html" class="sidebar-link">anno</a></li><li><a href="/blog/sping/aop.html" class="sidebar-link">Spring Aop切面编程</a></li><li><a href="/blog/sping/async.html" class="sidebar-link">Springboot的异步方法async调用与线程池配置</a></li><li><a href="/blog/sping/logback.html" class="sidebar-link">SpringBoot + LogBack 配置</a></li><li><a href="/blog/sping/redis.html" class="sidebar-link">redis与springboot整合</a></li><li><a href="/blog/sping/spring https.html" class="sidebar-link">springhttps</a></li><li><a href="/blog/sping/spring mvc.html" class="sidebar-link">springMVC</a></li><li><a href="/blog/sping/spring restTemplate.html" class="sidebar-link">spring RestTemplate</a></li><li><a href="/blog/sping/spring security.html" class="active sidebar-link">Spring security 配置</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Spring security 配置</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>luna</span>
            
          <span data-v-64685f0e>2020 - </span>
          2021
        </a></span></div></div> <div data-v-2d5f533b><main class="page" style="padding-right:0;"><div class="page-title" style="display:none;"><h1 class="title">Spring security 配置</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>luna</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2020-05-31</span></i> <i class="iconfont reco-eye" data-v-3b7f5bdf><span id="/blog/sping/spring%20security.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-3b7f5bdf><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>security</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><article class="baidu_pl"><div id="article_content" class="article_content clearfix"><link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-a405391f94.css"> <div id="content_views" class="htmledit_views"><p><strong>生活加油:摘一句子:</strong></p> <p><strong>“我希望自己能写这样的诗。我希望自己也是一颗星星。如果我会发光，就不必害怕黑暗。如果我自己是那么美好，那么一切恐惧就可以烟消云散。于是我开始存下了一点希望—如果我能做到，那么我就战胜了寂寞的命运。”</strong></p> <p>                                                                                 -----------------------------王小波《我在荒岛上迎接黎明》</p> <h1><a name="t0"></a><a name="t0"></a>初步嘗試一下：</h1> <p><strong>新建项目,导入依赖</strong></p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> : security学习</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 12:54</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@RestController</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HollerController</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello Security&quot;</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p><strong>访问接口:请求都被保护起来,用户名默认user,密码为控制台打印的字符串.</strong></p> <p><img alt="" height="336" src="https://img-blog.csdnimg.cn/2019122413045146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="801" class="has"></p> <p><img alt="" height="279" src="https://img-blog.csdnimg.cn/20191224130732495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="747" class="has"></p> <p><strong> 手工配置用户名和密码:</strong></p> <p>一,配置类方式:</p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.securityl.demo;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.crypto.password.NoOpPasswordEncoder;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> : security配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 13:13</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span> 密码处理,告诉系统不加密访问</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 13:20 2019/12/24</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [] </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> org.springframework.security.crypto.password.PasswordEncoder </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span> 配置用户名密码.密码必须加密</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 13:16 2019/12/24</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [auth] </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auth.inMemoryAuthentication()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;liruilong&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;liruilongs&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p><strong>配置文件方式:</strong></p> <p><img alt="" height="169" src="https://img-blog.csdnimg.cn/2019122413304389.png" width="523" class="has"></p> <p> </p> <h2><a name="t1"></a><a name="t1"></a>HttpScurity的简单配置:</h2> <div><strong><span style="color:#434343;">基于内存的认证，</span><span style="color:#5b5b5b;">以自定义类继承自 w</span><span style="color:#434343;">ebSecurityConfigurerAdapter </span><span style="color:#434343;">，进行自定义配置。</span></strong></div> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.securityl.demo;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> : security配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 13:13</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span> 密码处理,告诉系统不加密访问</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 13:20 2019/12/24</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [] </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> org.springframework.security.crypto.password.PasswordEncoder </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span> 配置用户名密码.密码必须加密</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 13:16 2019/12/24</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [auth] </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void </span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auth.inMemoryAuthentication()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;liruilong&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;liruilongs&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">//开启配置，开启 HtψSecurity 的配直</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        http.authorizeRequests()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 指定admin角色可以访问该路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 指定admin和user可以访问该路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasAnyRole(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 剩下的请求登录之后就可以访问</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .anyRequest().authenticated()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 表单登录的url,请求地址</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .formLogin()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginProcessingUrl(<span class="hljs-string">&quot;/dolog&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .permitAll()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 关闭csrf</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .csrf().disable();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <h3><a name="t2"></a><a name="t2"></a>表单登录的详细配置:</h3> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln" style="width:1652px;"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">//开启配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        http.authorizeRequests()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 指定admin角色可以访问该路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 指定admin和user可以访问该路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasAnyRole(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 剩下的请求登录之后就可以访问</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .anyRequest().authenticated()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 表单登录的url,请求地址</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .formLogin()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// url,请求地址</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginProcessingUrl(<span class="hljs-string">&quot;/dolog&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 登录页面</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginPage(<span class="hljs-string">&quot;login&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 修改默认的键,默认为username和password</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .usernameParameter(<span class="hljs-string">&quot;uname&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .passwordParameter(<span class="hljs-string">&quot;passwd&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 前后端分离,登录成功的处理</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">//authentication里保存了登录成功的用户信息</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">200</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">// 登录成功的用户信息</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        map.put(<span class="hljs-string">&quot;mes&quot;</span>, authentication.getPrincipal());</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">// 返回一个json</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 <span class="hljs-comment">//前后端不分,页面跳转</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .successForwardUrl(<span class="hljs-string">&quot;成功跳转&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//登录失败的处理</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">401</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> LockedException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;账户被锁定请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(e <span class="hljs-keyword">instanceof</span> CredentialsExpiredException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;密码过期请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> AccountExpiredException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;账户过期请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(e <span class="hljs-keyword">instanceof</span> DisabledException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;账户被禁用请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> BadCredentialsException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;用户名密码输入错误,请重新输入!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="63" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="64" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="65" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="66" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 前后端不分跳转</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="67" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .failureForwardUrl(<span class="hljs-string">&quot;失败跳转&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="68" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .permitAll()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="69" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="70" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 关闭csrf</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="71" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .csrf().disable();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="72" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="73" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="74" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="75" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="76" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p> <strong>登录接口为 &quot;/login”，即可以直接调用“／login”接口，发起一个 POST 请求进行登录，登录参数中用户 名必须命名为 usemam巳，密码必须命名为 password，配置了 loginProcessingUrl 接口主要方便或者移动端调用登录接口 。最后还配置了 permitAll，表示和登录相关的接口都不需要认 证即可访问。 </strong></p> <p><strong>anonymous() 允许匿名用户访问<br> permitAll() 无条件允许访问</strong></p> <h3><a name="t3"></a><a name="t3"></a>注销登录的配置:</h3> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln" style="width:1652px;"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">//开启配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        http.authorizeRequests()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 指定admin角色可以访问该路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .antMatchers(<span class="hljs-string">&quot;/admin/**&quot;</span>).hasRole(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 指定admin和user可以访问该路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .antMatchers(<span class="hljs-string">&quot;/user/**&quot;</span>).hasAnyRole(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 剩下的请求登录之后就可以访问</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .anyRequest().authenticated()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 表单登录的url,请求地址</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .formLogin()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// url,请求地址</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginProcessingUrl(<span class="hljs-string">&quot;/dolog&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 登录页面</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginPage(<span class="hljs-string">&quot;login&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 修改默认的键,默认为username和password</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .usernameParameter(<span class="hljs-string">&quot;uname&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .passwordParameter(<span class="hljs-string">&quot;passwd&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 前后端分离,登录成功的处理</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">//authentication里保存了登录成功的用户信息</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">200</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">// 登录成功的用户信息</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        map.put(<span class="hljs-string">&quot;mes&quot;</span>, authentication.getPrincipal());</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">// 返回一个json</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                 <span class="hljs-comment">//前后端不分,页面跳转</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .successForwardUrl(<span class="hljs-string">&quot;成功跳转&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//登录失败的处理</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .failureHandler(<span class="hljs-keyword">new</span> AuthenticationFailureHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        map.put(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">401</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> LockedException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;账户被锁定请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(e <span class="hljs-keyword">instanceof</span> CredentialsExpiredException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;密码过期请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> AccountExpiredException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;账户过期请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(e <span class="hljs-keyword">instanceof</span> DisabledException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;账户被禁用请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> BadCredentialsException){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;用户名密码输入错误,请重新输入!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(map));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="63" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="64" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .failureForwardUrl(<span class="hljs-string">&quot;失败跳转&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="65" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 任何角色可以访问</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="66" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .permitAll()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="67" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="68" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .logout()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="69" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 注销请求路劲</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="70" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="71" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 注销成功的处理</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="72" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="73" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="74" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="75" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="76" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="77" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(<span class="hljs-string">&quot;注销成功!&quot;</span>)));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="78" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="79" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="80" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="81" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="82" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .logoutSuccessUrl(<span class="hljs-string">&quot;注销成功的跳转&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="83" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="84" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">// 关闭csrf</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="85" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .csrf().disable();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="86" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="87" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="88" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="89" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="90" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <h3><a name="t4"></a><a name="t4"></a>多HttpSecurity配置： </h3> <p><strong>config 不需要继承 WebSecurityConfigurerAdapter, 在 MultiHttpSecurityConfig 中创建静态内部类继承 WebSecurityConfigurerAdapter 即可，静态 内部类上添加＠Configuration 注解和＠Order 注解，＠Order 注解表示该配直的优先级，数字 越小优先级越大，未加＠Order 注解的配直优先级最小。 </strong></p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> : 多HttpSecurity配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 17:01</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiHttpSecurity</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auth.inMemoryAuthentication()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;liruilong&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;liruilongs&quot;</span>).password(<span class="hljs-string">&quot;123&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Order(1)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-comment">//开启配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            http.antMatcher(<span class="hljs-string">&quot;/admin/**&quot;</span>).authorizeRequests().anyRequest().hasAnyRole(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OtherSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-comment">//开启配置</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            http.authorizeRequests().anyRequest().authenticated()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .formLogin()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .failureForwardUrl(<span class="hljs-string">&quot;/dolog&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .permitAll()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .csrf().disable();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <h3><a name="t5"></a><a name="t5"></a>密码加盐处理:</h3> <p><strong>通过BCryptPasswordEncoder生成密码密文,</strong></p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0</span>; i++){</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            BCryptPasswordEncoder encoder = <span class="hljs-keyword">new</span> BCryptPasswordEncoder();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            System.out.println(encoder.encode(<span class="hljs-string">&quot;123&quot;</span>));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> <span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> NoOpPasswordEncoder.getInstance();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">替换为</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <h3><a name="t6"></a><a name="t6"></a>方法安全:</h3> <p><strong>即该方法加一个权限,明确该方法是什么角色可以调用的.</strong></p> <p><strong>开发者也可以通过注解来灵活地配置方法安全，要 使用相关注解，首先要通过＠EnableGloba!MethodSecurity 注解开启基于注解的安全配置：</strong><br>  </p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln" style="width:1047px;"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//用于解锁注解。</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@EnableGlobalMethodSecurity(prePostEnabled = true,securedEnabled = true)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiHttpSecurityConfig</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auth.inMemoryAuthentication()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;javaboy&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$G3kVAJHvmRrr6sOj.j4xpO2Dsxl5EG8rHycPHFWyi9UMIhtdSH15u&quot;</span>).roles(<span class="hljs-string">&quot;admin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withUser(<span class="hljs-string">&quot;江南一点雨&quot;</span>).password(<span class="hljs-string">&quot;$2a$10$kWjG2GxWhm/2tN2ZBpi7bexXjUneIKFxIAaMYJzY7WcziZLCD4PZS&quot;</span>).roles(<span class="hljs-string">&quot;user&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Order(1)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            http.antMatcher(<span class="hljs-string">&quot;/admin/**&quot;</span>).authorizeRequests().anyRequest().hasAnyRole(<span class="hljs-string">&quot;admin&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OtherSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            http.authorizeRequests().anyRequest().authenticated()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .formLogin()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .permitAll()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .and()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    .csrf().disable();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p> </p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.securityl.demo.service;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.annotation.Secured;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> :</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 17:31</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Service</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">userservlce</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment">//</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@PreAuthorize(&quot;hasRole('admin')&quot;)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">admin</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello admin&quot;</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Secured(&quot;ROLB_user&quot;)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">users</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello user&quot;</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@PreAuthorize(&quot;hasAnyRole('admin','user')&quot;)</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello hello&quot;</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p>代码解释： •</p> <ul><li><strong>@Secured(”ROLE_ AD MIN＂）注解表示访问该方法需要 ADMIN 角色，注意这里需要在角色前加一个前缀“ROLE ’</strong></li><li><strong>@PreAuthorize（”hasRole（’AD MIN’） and hasRole('DBA＇）”）注解表示访问该方法既需妥 ADMIN 角色又需要 DBA 角色。 •</strong></li><li><strong>@PreAuthorize(&quot;hasAnyRole（’ADMIN','DBA','USER’）”）表示访问该方法需要 ADMIN、 DBA 或 USER 角色。 </strong></li><li><strong>•@PreAuthorize 和＠PostAuthorize 中都可以使用基于表达式的语法。</strong></li></ul> <h1><a name="t7"></a><a name="t7"></a>基于数据库的认证</h1> <h3><a name="t8"></a><a name="t8"></a>动态配置权限</h3> <ul><li><strong>配置自定义权限拦截withObjectPostProcessor</strong> <ul><li><img alt="" height="319" src="https://img-blog.csdnimg.cn/20200216114348376.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="1200"></li></ul></li><li><strong>定义自定义拦截逻辑,获取有当前访问路径权限的所有角色,返回角色数组.</strong> <ul><li><strong>通过FilterlnvocationSecurityMetadataSource 接口中的 getAttributes 方法来确定一个请求需要哪些角色</strong></li><li><img alt="" height="765" src="https://img-blog.csdnimg.cn/20200216114755243.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="961"></li></ul></li><li><strong>自定义角色比对之后的逻辑.判断当前用户是否有访问角色.的权利,</strong> <ul><li><strong><span style="color:#f33b45;">自定义 AccessDecisionManager 并重写 decide 方法，decide有三个参数,当前登录用户的信息,请求对象,上一个getAttribute返回的角色数组.</span></strong></li><li><img alt="" height="625" src="https://img-blog.csdnimg.cn/20200216124415775.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="979"></li></ul></li></ul> <h1><a name="t9"></a><img alt="" height="208" src="https://img-blog.csdnimg.cn/20200213122344351.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="705" class="has"><br><img alt="" height="518" src="https://img-blog.csdnimg.cn/20200213121307187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="1200" class="has"></h1> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln hundred"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.hros.model;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JacksonInject;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.GrantedAuthority;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.util.ArrayList;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.util.Collection;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.util.List;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetails</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> Integer id;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String name;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String phone;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String telephone;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String address;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> Boolean enabled;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String username;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String password;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String userface;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> String remark;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">private</span> List&lt;Role&gt; roles;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> id;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.id = id;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> name;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.name = name == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : name.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPhone</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> phone;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPhone</span><span class="hljs-params">(String phone)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.phone = phone == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : phone.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTelephone</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="63" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> telephone;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="64" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="65" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="66" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTelephone</span><span class="hljs-params">(String telephone)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="67" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.telephone = telephone == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : telephone.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="68" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="69" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="70" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAddress</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="71" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> address;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="72" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="73" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="74" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAddress</span><span class="hljs-params">(String address)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="75" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.address = address == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : address.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="76" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="77" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="78" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="79" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="80" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEnabled</span><span class="hljs-params">(Boolean enabled)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="81" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.enabled = enabled;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="82" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="83" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="84" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="85" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="86" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> username;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="87" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="88" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="89" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.username = username == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : username.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="90" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="91" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="92" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="93" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="94" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> password;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="95" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="96" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="97" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="98" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.password = password == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : password.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="99" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="100" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="101" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUserface</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="102" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> userface;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="103" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="104" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="105" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserface</span><span class="hljs-params">(String userface)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="106" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.userface = userface == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : userface.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="107" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="108" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="109" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRemark</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="110" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> remark;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="111" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="112" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="113" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRemark</span><span class="hljs-params">(String remark)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="114" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.remark = remark == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : remark.trim();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="115" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="116" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="117" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="118" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonExpired</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="119" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="120" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="121" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="122" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="123" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAccountNonLocked</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="124" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="125" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="126" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="127" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="128" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCredentialsNonExpired</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="129" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="130" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="131" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="132" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="133" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEnabled</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="134" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> enabled;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="135" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="136" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="137" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="138" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="139" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@JsonIgnore</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="140" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="141" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      List&lt;SimpleGrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(roles.size());</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="142" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">      roles.stream().forEach( (role) -&gt;authorities.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(role.getName())));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="143" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> authorities;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="144" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="145" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="146" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Role&gt; <span class="hljs-title">getRoles</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="147" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> roles;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="148" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="149" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="150" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRoles</span><span class="hljs-params">(List&lt;Role&gt; roles)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="151" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">this</span>.roles = roles;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="152" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="153" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p><img alt="" height="269" src="https://img-blog.csdnimg.cn/20200216112457918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="777"></p> <p><strong>要实现动态配置权限，首先要自定义 FilterlnvocationSecurityMetadataSource,<span style="color:#f33b45;">自定义权限拦截,获取当前请求的所有角色</span></strong>,<strong> Spring Security 中通过 FilterlnvocationSecurityMetadataSource 接口中的 getAttributes 方法来确定一个请求需要哪些 角色， FilterlnvocationSecurityMetadataSource 接口的默认实现类是 DefaultFilterlnvocationSecurityMetadataSource ，参考 DefaultFilterlnvocationSecurityMetadataSource 的实现，开发者可以定义自己的 FilterlnvocationSecurityMetadataSource，</strong></p> <p><strong><code>SecurityMetadataSource</code>是<code>Spring Security</code>的一个概念模型接口。用于表示对受权限保护的&quot;安全对象&quot;的权限设置信息。一个该类对象可以被理解成一个映射表，映射表中的每一项包含如下信息 :</strong></p> <ul><li><strong>安全对象</strong></li><li><strong>安全对象所需权限信息</strong></li></ul> <p><strong>围绕该映射表，</strong></p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.hros.config;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.mapper.MenuMapper;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.model.Menu;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.model.Role;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.service.MenuService;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.ConfigAttribute;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.SecurityConfig;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.FilterInvocation;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.access.intercept.FilterInvocationSecurityMetadataSource;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.util.AntPathMatcher;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.util.Collection;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.util.List;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> : 权限处理,根据请求,分析需要的角色,该类的主要功能就是通过当前的请求地址，获取该地址需要的用户角色</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 12:17</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Component</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFilterInvocationSecurityMetadataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FilterInvocationSecurityMetadataSource</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    MenuService menuService;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment">//路径比较工具</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    AntPathMatcher antPathMatcher = <span class="hljs-keyword">new</span> AntPathMatcher();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> java.util.Collection&lt;org.springframework.security.access.ConfigAttribute&gt;</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span> 当前请求需要的角色</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 18:13 2019/12/24</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [object]</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAttributes</span><span class="hljs-params">(Object object)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">//获取当前请求路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        String requestUrl = ((FilterInvocation) object).getRequestUrl();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">//获取所有的菜单url路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        List&lt;Menu&gt; menus = menuService.getAllMenusWithRole();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> (Menu menu : menus) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">if</span> (antPathMatcher.match(menu.getUrl(), requestUrl)) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//拥有当前菜单权限的角色</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                List&lt;Role&gt; roles = menu.getRoles();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                String[] strings = <span class="hljs-keyword">new</span> String[roles.size()];</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; roles.size(); i++) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    strings[i] = roles.get(i).getName();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">return</span> SecurityConfig.createList(strings);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-comment">// 没匹配上的资源都是登录</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> SecurityConfig.createList(<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="hljs-title">getAllConfigAttributes</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="63" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="64" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="65" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <h3><a name="t10"></a><a name="t10"></a><strong> 开发者自定义 FilterlnvocationSecurityrMetadataSource</strong> :</h3> <p><span style="color:#f33b45;"><strong>主要实现该接口中的 getAttributes 方法， 该方法的参数是一个 FilterInvocation， 开发者可以从 Filterlnvocation 中提取出当前请求的 URL，返回值是 Collection&lt;ConfigAttribute&gt;，表示当前请求 URL 所需的角色</strong></span>。</p> <ul><li>创建一个 AntPathMatcher，主要用来实现 ant 风格的 URL 匹配。</li><li>从参数中提取出当前请求的 URL。</li><li>从数据库中获取所有的资源信息，即本案例中的 menu 表以及 menu 所对应的 role,</li><li>追历资源信息，边历过程中获取当前请求的 URL 所需要的角色信息并返回。如 果当前请求的 URL 在资源表中不存在相应的模式，就假设该请求登录后即可访问，即直接返代码解释： ROLE LOGJN。</li><li>getAllConfigAttributes 方法用来返回所有定义好的权限资源， Spring Security 在启动时会校验 相关配置是否正确，如果不需要校验，那么该方法直接返回 null 即可。 supports 方法返回类对象是否支持校验。 </li></ul> <h3><a name="t11"></a><a name="t11"></a> 自定义 AccessDecisionManager</h3> <p><span style="color:#f33b45;"><strong>当一个请求走完 FilterlnvocationSecurityMetadataSource 中的 getAttributes 方法后，接下来就会 来到 AccessDecisionManager 类中进行角色信息的比对，自定义 AccessDecisionManager 如下：</strong></span><br>  </p> <pre name="code" class="has"><code class="language-java hljs"><ol class="hljs-ln" style="width:1483px;"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.hros.config;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.AccessDecisionManager;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.AccessDeniedException;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.access.ConfigAttribute;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.authentication.AnonymousAuthenticationToken;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.authentication.InsufficientAuthenticationException;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.Authentication;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.GrantedAuthority;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.util.Collection;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> : 判断当前用户是否具备菜单访问，当一个请求走完 FilterlnvocationSecurityMetadataSource 中的 getAttributes 方法后，接下来就会 来到 AccessDecisionManager 类中进行角色信息的比对</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/24 19:12</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Component</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomUrlDecisionManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccessDecisionManager</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span> decide 方法有三个参数， 第一个参数包含当前登录用户的信息；</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * 第二个参数则是一个 Filterlnvocation 对 象 ，可以 获 取当前请求对 象等；</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * 第 三个参 数就是 FilterlnvocationSecurityMetadataSource 中的 getAttributes 方法的返回值， 即当前请求 URL 所 需要的角色。</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 18:28 2020/2/13</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [authentication, object, configAttributes]</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decide</span><span class="hljs-params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">for</span> (ConfigAttribute configAttribute : configAttributes) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            String needRole = configAttribute.getAttribute();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;ROLE_LOGIN&quot;</span>.equals(needRole)) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//判断用户是否登录</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">if</span> (authentication <span class="hljs-keyword">instanceof</span> AnonymousAuthenticationToken) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;尚未登录，请登录!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                } <span class="hljs-keyword">else</span> {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-keyword">return</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            <span class="hljs-keyword">for</span> (GrantedAuthority authority : authorities) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-keyword">if</span> (authority.getAuthority().equals(needRole)) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-keyword">return</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">            }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AccessDeniedException(<span class="hljs-string">&quot;权限不足，请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(ConfigAttribute attribute)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="63" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="64" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="65" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="66" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">// authorities.stream().anyMatch((authority) -&gt;authority.getAuthority().equals(attribute));</span></div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p><strong><span style="color:#f33b45;">自定义 AccessDecisionManager 并重写 decide 方法，</span></strong></p> <p><strong>在该方法中判断当前登录的用户是否具 备当前请求 URL 所需要的角色信息，如果不具备，就抛出 AccessDeniedException 异常，否 则不做任何事即可。 </strong></p> <p><span style="color:#f33b45;"><strong>decide 方法有三个参数，</strong></span></p> <p><span style="color:#f33b45;"><strong>第一个参数包含当前登录用户的信息；</strong></span></p> <p><span style="color:#f33b45;"><strong>第二个参数则是一个 Filterlnvocation 对 象 ，可以 获 取当前请求对 象等；</strong></span></p> <p><span style="color:#f33b45;"><strong>第 三个参 数就是 FilterlnvocationSecurityMetadataSource 中的 getAttributes 方法的返回值， 即当前请求 URL 所 需要的角色。</strong></span></p> <p><strong>进行角色信息对比，如果需要的角色是 ROLE_LOG，说明当前请求的 URL 用 户登录后即可访问，如果 auth 是 UsemamePasswordAuthenticationToken 的实例，那么说明当前用户已登录，该方法到此结束，否则进入正常的判断流程，如果当前用户具备当前请求需 要的角色，那么方法结束。</strong></p> <p><strong>springSecurity配置流程分析:</strong></p> <p><img alt="" height="819" src="https://img-blog.csdnimg.cn/20200216171913215.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="1009"></p> <p><img alt="" height="589" src="https://img-blog.csdnimg.cn/20200216171937340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Nhbmhld3V5YW5n,size_16,color_FFFFFF,t_70" width="671"></p> <pre><code class="language-java hljs"><ol class="hljs-ln hundred" style="width:1658px;"><li><div class="hljs-ln-numbers"><div data-line-number="1" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">package</span> com.liruilong.hros.config;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="2" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="3" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="4" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.filter.VerifyCodeFilter;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="5" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.model.Hr;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="6" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.model.RespBean;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="7" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> com.liruilong.hros.service.HrService;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="8" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="9" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="10" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="11" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.authentication.*;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="12" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.ObjectPostProcessor;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="13" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="14" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="15" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.WebSecurity;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="16" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="17" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.Authentication;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="18" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.core.AuthenticationException;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="19" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="20" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="21" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.AuthenticationEntryPoint;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="22" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.access.intercept.FilterSecurityInterceptor;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="23" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.authentication.AuthenticationSuccessHandler;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="24" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="25" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> org.springframework.security.web.authentication.logout.LogoutSuccessHandler;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="26" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="27" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> javax.servlet.ServletException;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="28" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="29" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="30" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.io.IOException;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="31" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">import</span> java.io.PrintWriter;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="32" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="33" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="34" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span> :</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="35" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="36" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: 2019/12/18 19:11</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="37" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"> */</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="38" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="39" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">@Configuration</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="40" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="41" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="42" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    HrService hrService;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="43" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="44" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    CustomFilterInvocationSecurityMetadataSource customFilterInvocationSecurityMetadataSource;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="45" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="46" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    CustomUrlDecisionManager customUrlDecisionManager;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="47" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">     <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="48" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    VerifyCodeFilter verifyCodeFilter ;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="49" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Autowired</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="50" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    MyAuthenticationFailureHandler myAuthenticationFailureHandler;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="51" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="52" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="53" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="54" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        http.addFilterBefore(verifyCodeFilter, UsernamePasswordAuthenticationFilter.class)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="55" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .authorizeRequests()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="56" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                //.anyRequest().authenticated()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="57" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                //所有请求的都会经过这进行鉴权处理。返回当前请求需要的角色。</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="58" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .withObjectPostProcessor(<span class="hljs-keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="59" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="60" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="hljs-function">O <span class="hljs-title">postProcess</span><span class="hljs-params">(O object)</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="61" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        object.setSecurityMetadataSource(customFilterInvocationSecurityMetadataSource);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="62" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        object.setAccessDecisionManager(customUrlDecisionManager);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="63" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-keyword">return</span> object;</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="64" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="65" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="66" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .and().formLogin().usernameParameter(<span class="hljs-string">&quot;username&quot;</span>).passwordParameter(<span class="hljs-string">&quot;password&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="67" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//设置登录请求的url路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="68" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginProcessingUrl(<span class="hljs-string">&quot;/doLogin&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="69" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment"><span class="hljs-comment">/*需要身份验证时，将浏览器重定向到/ login</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="70" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">                我们负责在请求/ login时呈现登录页面</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="71" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">                当身份验证尝试失败时，将浏览器重定向到/ login？error（因为我们没有另外指定）</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="72" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">                当请求/ login？error时，我们负责呈现失败页面</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="73" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">                成功注销后，将浏览器重定向到/ login？logout（因为我们没有另外指定）</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="74" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">                我们负责在请求/ login？logout时呈现注销确认页面*/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="75" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .loginPage(<span class="hljs-string">&quot;/login&quot;</span>)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="76" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//登录成功回调</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="77" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .successHandler(<span class="hljs-keyword">new</span> AuthenticationSuccessHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="78" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="79" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="80" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="81" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="82" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        Hr hr = (Hr) authentication.getPrincipal();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="83" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">//密码不回传</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="84" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        hr.setPassword(<span class="hljs-keyword">null</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="85" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        RespBean ok = RespBean.ok(<span class="hljs-string">&quot;登录成功！&quot;</span>, hr);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="86" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">//将hr转化为Sting</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="87" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        String s = <span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(ok);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="88" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(s);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="89" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="90" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="91" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="92" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="93" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//登失败回调</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="94" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .failureHandler(myAuthenticationFailureHandler)</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="95" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//相关的接口直接返回</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="96" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .permitAll().and().logout()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="97" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//注销登录</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="98" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .logoutSuccessHandler(<span class="hljs-keyword">new</span> LogoutSuccessHandler() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="99" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="100" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLogoutSuccess</span><span class="hljs-params"><span class="hljs-params">(HttpServletRequest httpServletRequest,</span></span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="101" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-params">                                                HttpServletResponse httpServletResponse,</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="102" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-params">                                                Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="103" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        httpServletResponse.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="104" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = httpServletResponse.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="105" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(RespBean.ok(<span class="hljs-string">&quot;注销成功!&quot;</span>)));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="106" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="107" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="108" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="109" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                })</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="110" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .permitAll().and().csrf().disable().exceptionHandling()</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="111" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                <span class="hljs-comment">//没有认证时，在这里处理结果，不要重定向</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="112" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                .authenticationEntryPoint(</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="113" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-comment">//myAuthenticationEntryPoint;</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="114" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-keyword">new</span> AuthenticationEntryPoint() {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="115" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="116" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">commence</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException authException)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="117" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="118" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        resp.setStatus(<span class="hljs-number">401</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="119" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        PrintWriter out = resp.getWriter();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="120" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        RespBean respBean = RespBean.error(<span class="hljs-string">&quot;访问失败!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="121" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        <span class="hljs-keyword">if</span> (authException <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) {</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="122" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                            respBean.setMsg(<span class="hljs-string">&quot;请求失败，请联系管理员!&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="123" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="124" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.write(<span class="hljs-keyword">new</span> ObjectMapper().writeValueAsString(respBean));</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="125" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.flush();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="126" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                        out.close();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="127" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="128" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">                });</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="129" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="130" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Bean</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="131" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function">PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="132" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BCryptPasswordEncoder();</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="133" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="134" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="135" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="136" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        auth.userDetailsService(hrService);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="137" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="138" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-comment"><span class="hljs-comment">/**</span></span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="139" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> Liruilong</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="140" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Description</span>  放行的请求路径</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="141" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Date</span> 19:25 2020/2/7</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="142" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@Param</span> [web]</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="143" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> void</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="144" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">     **/</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="145" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-meta">@Override</span></div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="146" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>{</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="147" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">        web.ignoring().antMatchers(<span class="hljs-string">&quot;/auth/code&quot;</span>,<span class="hljs-string">&quot;/login&quot;</span>,<span class="hljs-string">&quot;/css/**&quot;</span>,<span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/img/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>,<span class="hljs-string">&quot;/favicon.ico&quot;</span>);</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="148" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">    }</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="149" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="150" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div data-line-number="151" class="hljs-ln-line hljs-ln-n"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li></ol></code><div data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)" class="hljs-button {2}"></div></pre> <p>SpringSecurity执行流程分析:</p> <p><img alt="" src="https://img-blog.csdn.net/20180318211512445?watermark/2/text/Ly9ibG9nLmNzZG4ubmV0L3UwMTM0MzU4OTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p> <p>UsernamePasswordAuthenticationFilter就是拦截我们通过表单提交接口提交的用户名和密码，如果是Basic提交的话，就会被BasicAuthenticationFilter拦截，最后的橙色FilterSecurityInterceptor是首先判断我们当前请求的url是否需要认证，如果需要认证，那么就看当前请求是否已经认证，是的话就放行到我们要访问的接口，否则重定向到认证页面。<br>  </p> <p>UsernamePasswordAuthenticationFilter首先会拦截请求，而UsernamePasswordAuthenticationFilter是继承于AbstractAuthenticationProcessingFilter的，在这个抽象类中已经定义好了doFilter的方法，而里面有一个attemptAuthentication方法是由子类实现的。所以当提交表单时spring security会发现这个一个表单提交，然后就调用了UsernamePasswordAuthenticationFilter的doFilter方法</p> <p>springSecurity其实就是一组过滤器，请求和响应都会经过这些过滤器，在系统启动的时候，spring boot会自动配上</p> <p>黄色：已经存储的认证信息</p> <p>绿色：处理用户身份认证</p> <p>橙色：捕获黄色抛出的异常</p> <p>蓝色：决定当前请求是否通过之前某个过滤器的身份认证，不能通过就抛出异常，通过了会帮我们直接跳转</p> <p><img alt="" src="https://img-blog.csdnimg.cn/20191205165135360.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NoYW5kZWFpNTIw,size_16,color_FFFFFF,t_70"></p> <p> </p> <p>它的身份认证其实是始于访问资源开始。如果一个用户已登录，那么访问受保护的资源，则会校验该用户是否有权限访问。如果没有权限，则会调用权限拒绝的处理器进行处理。如果有权限，则能顺利访问该资源；</p> <p>一个用户未登录情况下，也即匿名用户，访问受保护的资源时，spring security会首先检查该资源是否需要权限，如果需要权限，然后再检查，该资源是否是白名单里面。如果是白名单，也能正常访问。如果是受保护的资源，则会提示该用户需要登录。<br>  </p> <p> </p> <p>感觉学的不大好.....</p></div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;dest&quot;:&quot;https://blog.csdn.net/sanhewuyang/article/details/103681432&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div></div></article></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">更新于: </span> <span class="time">2020/9/30 上午11:59:35</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="reco-bgm-panel" data-v-39f9e6e0><audio id="bgm" src="/blog/audio/DancingWithYourGhost.mp3" data-v-39f9e6e0></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><img src="/blog/images/DancingWithYourGhost.jpg" data-v-39f9e6e0></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:99999;" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><div class="reco-bgm-cover" style="background-image:url(/blog/images/DancingWithYourGhost.jpg);" data-v-39f9e6e0><div class="mini-operation" style="display:none;" data-v-39f9e6e0><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-39f9e6e0></i></div> <div class="falut-message" style="display:none;" data-v-39f9e6e0>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><div class="info-box" data-v-39f9e6e0><i class="reco-bgm reco-bgm-music music" data-v-39f9e6e0></i>Sasha Sloan - Dancing With Your Ghost</div> <div class="info-box" data-v-39f9e6e0><i class="reco-bgm reco-bgm-artist" data-v-39f9e6e0></i>Sasha Sloan</div> <div class="reco-bgm-progress" data-v-39f9e6e0><div class="progress-bar" data-v-39f9e6e0><div class="bar" data-v-39f9e6e0></div></div></div> <div class="reco-bgm-operation" data-v-39f9e6e0><i class="reco-bgm reco-bgm-last last" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-play play" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-next next" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-39f9e6e0></i> <div class="volume-bar" data-v-39f9e6e0><div class="bar" data-v-39f9e6e0></div></div></div></div> <div class="reco-bgm-left-box" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><i class="reco-bgm reco-bgm-left" data-v-39f9e6e0></i></div></div></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:10px;bottom:190px;display:none;" data-v-5775ee02>
      luna-message
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/blog/assets/js/app.5f78a6e3.js" defer></script><script src="/blog/assets/js/3.068b4ef9.js" defer></script><script src="/blog/assets/js/1.3a4037f8.js" defer></script><script src="/blog/assets/js/78.5acf7838.js" defer></script>
  </body>
</html>
